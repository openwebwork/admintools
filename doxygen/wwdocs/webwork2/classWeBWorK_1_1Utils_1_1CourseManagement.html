<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::Utils::CourseManagement Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1Utils.html">Utils</a>::<a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html">CourseManagement</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::Utils::CourseManagement Class Reference</h1><!-- doxytag: class="WeBWorK::Utils::CourseManagement" --><!-- doxytag: inherits="WeBWorK::Utils" --><div class="dynheader">
Inheritance diagram for WeBWorK::Utils::CourseManagement:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Utils_1_1CourseManagement__inherit__graph.png" border="0" usemap="#WeBWorK_1_1Utils_1_1CourseManagement_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1Utils_1_1CourseManagement_inherit__map" id="WeBWorK_1_1Utils_1_1CourseManagement_inherit__map">
<area shape="rect" href="classWeBWorK_1_1Utils_1_1CourseManagement_1_1sql__moodle.html" title="WeBWorK::Utils::CourseManagement::sql_moodle" alt="" coords="596,5,911,32"/><area shape="rect" href="classWeBWorK_1_1Utils_1_1CourseManagement_1_1sql__single.html" title="WeBWorK::Utils::CourseManagement::sql_single" alt="" coords="600,56,907,83"/><area shape="rect" href="classWeBWorK_1_1Utils.html" title="WeBWorK::Utils" alt="" coords="139,31,256,57"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="7,31,89,57"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::Utils::CourseManagement:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Utils_1_1CourseManagement__coll__graph.png" border="0" usemap="#WeBWorK_1_1Utils_1_1CourseManagement_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1Utils_1_1CourseManagement_coll__map" id="WeBWorK_1_1Utils_1_1CourseManagement_coll__map">
<area shape="rect" href="classWeBWorK_1_1Utils.html" title="WeBWorK::Utils" alt="" coords="67,80,184,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="84,5,167,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1Utils_1_1CourseManagement-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement_1_1sql__moodle.html">sql_moodle</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement_1_1sql__single.html">sql_single</a></td></tr>
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">private method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a0cc737c6a9b300bc925a18ceb9c5a8cb">_archiveCourse_remove_dump_dir</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">private method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a23b10750a7f6467d53355bc9ceb75f83">_unarchiveCourse_move_away</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">private method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#afe72cbd318c5f127b81bfbda8065a87e">_unarchiveCourse_move_back</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a58e22d09c07dc244f0891d46fcee737c">archiveCourseHelper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a61c4e546ef87db717ebaca66cc3ee13f">callHelperIfExists</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a466be9538ed09bdd3458d0c1dc4f6720">writeCourseConf</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a885849d795b1ed78a5755453ebb72d51">unarchiveCourseHelper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a851e3da30c00e369bcb2ef0e8f2d93c4">listArchivedCourses</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#adba87e54c53b8e9451464b72ce43bf26">deleteCourse</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a2a2bce56a70f92f98083334ff00c1de1">renameCourse</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a3835076848ebaee14d69059aa8d03f39">initNonNativeTables</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a1dc2740fc57733be708c89a7def1ef9e">archiveCourse</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a09aafa3576522f17b65b9ef6e8e42bc8">dbLayoutSQLSources</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a3aa5b9e1b4490cb3a4b4af62e518039c">unarchiveCourse</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a9f005a4c2b8a0af7f864ddac37cc4b82">getHelperRef</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a26e19e2f0534444aa03878eb71636507">addCourse</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aaecb3b19f9fe81b07409176e7fa7f043">listCourses</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aebe71be9cac592f0ba02c1df9e7192f1">protectQString</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a46517fa1f6f6b35f4e7d03c6884e608b">get_SeedCE</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html">WeBWorK::Utils::CourseManagement</a> - create, rename, and delete courses.</p>
<h2><a class="anchor" id="FUNCTIONS">
FUNCTIONS</a></h2>
<p>&lt;blockquote&gt; &lt;/blockquote&gt; </p>
<p>Lists the courses defined. </p>
<p>Lists the courses which have been archived (end in .tar.gz). </p>
<p>%options must contain: </p>
<pre> courseID =&gt; $courseID,
 ce =&gt; $ce,
 courseOptions =&gt; $courseOptions, 
 dbOptions =&gt; $dbOptions,
 users =&gt; $users</pre><p>%options may contain: </p>
<pre> templatesFrom =&gt; $templatesCourseID,</pre><p>Create a new course named $courseID. </p>
<p>$ce is a <a class="el" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a> object that describes the new course's environment. </p>
<p>$courseOptions is a reference to a hash containing the following options: </p>
<pre> dbLayoutName         =&gt; $dbLayoutName
 allowedRecipients    =&gt; $mail{allowedRecipients}
 feedbackRecipients   =&gt; $mail{feedbackRecipients}
 PRINT_FILE_NAMES_FOR =&gt; $pg{specialPGEnvironmentVars}-&gt;{PRINT_FILE_NAMES_FOR}</pre><div class="fragment"><pre class="fragment">dbLayoutName
</pre></div><p> is required. </p>
<div class="fragment"><pre class="fragment">allowedRecipients
</pre></div><p> , </p>
<div class="fragment"><pre class="fragment">feedbackRecipients
</pre></div><p> , and</p>
<div class="fragment"><pre class="fragment">PRINT_FILE_NAMES_FOR
</pre></div><p> are references to arrays. </p>
<p>$dbOptions is a reference to a hash containing information required to create a database for the course. Current database layouts do not require additional information, so specify a reference to an empty hash. If $dbOptions is undefined, <a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a26e19e2f0534444aa03878eb71636507">addCourse()</a> assumes that the database has already been created, and skips that step in the course creation process. </p>
<p>$users is a list of arrayrefs, each containing a User, Password, and PermissionLevel record for a single user: </p>
<pre> $users = [ $User, $Password, $PermissionLevel ]</pre><p>These users are added to the course. </p>
<p>$templatesCourseID indicates the ID of a course from which the contents of the templates directory will be copied to the new course. </p>
<p>%options must contain: </p>
<pre> courseID =&gt; $courseID,
 ce =&gt; $ce,
 dbOptions =&gt; $dbOptions,
 newCourseID =&gt; $newCourseID,</pre><p>%options may also contain: </p>
<pre> skipDBRename =&gt; $skipDBRename,</pre><p>Rename the course named $courseID to $newCourseID. </p>
<p>$ce is a <a class="el" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a> object that describes the existing course's environment. </p>
<p>$dbOptions is a reference to a hash containing information required to create the course's new database and delete the course's old database. Current database layouts do not require additional information, so specify a reference to an empty hash. </p>
<p>The name of the course's directory is changed to $newCourseID. </p>
<p>If the course's database layout is </p>
<div class="fragment"><pre class="fragment">sql_single
</pre></div><p> or </p>
<div class="fragment"><pre class="fragment">sql_moodle
</pre></div><p> , new tables are created in the current database, course data is copied from the old tables to the new tables, and the old tables are deleted. </p>
<p>If the course's database layout is something else, no database changes are made. </p>
<p>If $skipDBRename is true, no database changes are made. This is useful if a course is being unarchived and no database was found, or for renaming the modelCourse. </p>
<p>Any errors encountered while renaming the course are returned. </p>
<p>Options must contain: </p>
<pre> courseID =&gt; $courseID,
 ce =&gt; $ce,
 dbOptions =&gt; $dbOptions,</pre><p>$ce is a <a class="el" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a> object that describes the course's environment. It is your responsability to pass a course environment object that describes the course to be deleted. Do not pass the course environment object associated with the request, unless you are deleting the course you're currently using. </p>
<p>$dbOptions is a reference to a hash containing information required to delete the database for the course. Current database layouts do not require additional information, so specify a reference to an empty hash. If $dbOptions is undefined, <a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a26e19e2f0534444aa03878eb71636507">addCourse()</a> assumes that the database has already been deleted, and skips that step in the course deletion process. </p>
<p>Deletes the course named $courseID. The course directory is removed. </p>
<p>Any errors encountered while deleting the course are returned. </p>
<p>%options must contain: </p>
<pre> courseID  =&gt; $courseID,
 ce        =&gt; $ce,</pre><p>Creates a gzipped tar archive (.tar.gz) of the course $courseID in the <a class="el" href="classWeBWorK.html">WeBWorK</a> courses directory. Before archiving, the course database is dumped into a subdirectory of the course's DATA directory. </p>
<p>Only files and directories stored directly in the course directory are archived. The contents of linked files is not archived although the symbolic links themselves are saved. </p>
<p>$courseID is the name of the course to archive. </p>
<p>$ce is a <a class="el" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a> object that describes the course's environment. (This is used to access the course database and get path information.) </p>
<p>If an error occurs, an exception is thrown. </p>
<p>%options must contain: </p>
<pre> oldCourseID =&gt; $oldCourseID,
 archivePath =&gt; $archivePath,
 ce          =&gt; $ce,</pre><p>%options may also contain: </p>
<pre> newCourseID =&gt; $newCourseID,</pre><p>Restores course $oldCourseID from a gzipped tar archive (.tar.gz) located at $archivePath. After unarchiving, the course database is restored from a subdirectory of the course's DATA directory. </p>
<p>If $newCourseID is defined and differs from $oldCourseID, the course is renamed after unarchiving. </p>
<p>$ce is a <a class="el" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a> object that describes the some course's environment. (Usually this would be the admin course.) This is used to access the course database and get path information. </p>
<p>If an error occurs, an exception is thrown. </p>
<p>Retrun a hash of database sources for the sql and <a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement_1_1sql__single.html">sql_single</a> database layouts. Each element of the hash takes this form: </p>
<pre> dbi_source =&gt; {
     tables =&gt; [ 'table1', 'table2', ... ],
     username =&gt; 'username',
     password =&gt; 'password',
 }</pre><p>In the common case, there will only be one source returned.</p>
<h2><a class="anchor" id="DATABASE-LAYOUT_SPECIFIC_HELPER_FUNCTIONS">
DATABASE-LAYOUT SPECIFIC HELPER FUNCTIONS</a></h2>
<p>These functions are used to perform database-layout specific operations. </p>
<p>The implementations in this class do nothing, but if an appropriate function exists in a class with the name <a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html">WeBWorK::Utils::CourseManagement</a>::<em>$dbLayoutName</em>, it will be used instead. </p>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_archiveCourseHelper__courseID___ce___dbLayoutName____options_"></a><b>archiveCourseHelper($courseID, $ce, $dbLayoutName, %options)</b> </p>
<p class="endli">Perform database-layout specific operations for archiving the data in a course.  </p>
</li>
</ul>
<p>Perform database-layout specific operations for unarchiving the data in a course and placing it in the database. </p>
<p>Perform database-layout specific operations for initializing non-native database tables that are not associated with a particular course</p>
<h2><a class="anchor" id="UTILITIES">
UTILITIES</a></h2>
<p>These functions are used by this class's public functions and should not be called directly. </p>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_callHelperIfExists__helperName___dbLayoutName____args_"></a><b>callHelperIfExists($helperName, $dbLayoutName, @args)</b> </p>
<p class="endli">Call a database-specific helper function, if a database-layout specific helper class exists and contains a function named "${helperName}Helper".  </p>
</li>
</ul>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_getHelperRef__helperName___dbLayoutName_"></a><b>getHelperRef($helperName, $dbLayoutName)</b> </p>
<p class="endli">Call a database-specific helper function, if a database-layout specific helper class exists and contains a function named "${helperName}Helper".  </p>
</li>
</ul>
<p>Protects the contents of a single-quoted Perl string. </p>
<p>Writes a course.conf file to $fh, a file handle, using defaults from the course environment object $ce and overrides from %options. %options can contain any of the pairs accepted in %courseOptions by <a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a26e19e2f0534444aa03878eb71636507">addCourse()</a>, above. </p>

<p>Definition at line <a class="el" href="CourseManagement_8pm_source.html#l00206">206</a> of file <a class="el" href="CourseManagement_8pm_source.html">CourseManagement.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a0cc737c6a9b300bc925a18ceb9c5a8cb"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::_archiveCourse_remove_dump_dir" ref="a0cc737c6a9b300bc925a18ceb9c5a8cb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">private method WeBWorK::Utils::CourseManagement::_archiveCourse_remove_dump_dir </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-_archiveCourse_remove_dump_dir' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-_archiveCourse_remove_dump_dir-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_archiveCourse_remove_dump_dir-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_archiveCourse_remove_dump_dir-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in _archiveCourse_remove_dump_dir: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a0cc737c6a9b300bc925a18ceb9c5a8cb">_archiveCourse_remove_dump_dir</a> {
    my ($ce, $dump_dir) = @_;
    my $rm_cmd = <span class="stringliteral">&quot;2&gt;&amp;1 &quot;</span> . $ce-&gt;{externalPrograms}{rm}
        . <span class="stringliteral">&quot; -rf &quot;</span> . shell_quote($dump_dir);
    my $rm_out = readpipe $rm_cmd;
    <span class="keywordflow">if</span> ($?) {
        my $exit = $? &gt;&gt; 8;
        my $signal = $? &amp; 127;
        my $core = $? &amp; 128;
        carp <span class="stringliteral">&quot;Failed to remove course database dump directory &#39;$dump_dir&#39; with command &#39;$rm_cmd&#39; (exit=$exit signal=$signal core=$core): $rm_out\n&quot;</span>;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a23b10750a7f6467d53355bc9ceb75f83"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::_unarchiveCourse_move_away" ref="a23b10750a7f6467d53355bc9ceb75f83" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">private method WeBWorK::Utils::CourseManagement::_unarchiveCourse_move_away </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-_unarchiveCourse_move_away' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-_unarchiveCourse_move_away-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_unarchiveCourse_move_away-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_unarchiveCourse_move_away-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in _unarchiveCourse_move_away: 37</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a23b10750a7f6467d53355bc9ceb75f83">_unarchiveCourse_move_away</a> {
    my ($ce, $courseID) = @_;
    
<span class="preprocessor">    # course environment for before the course is moved</span>
<span class="preprocessor"></span>    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a46517fa1f6f6b35f4e7d03c6884e608b">get_SeedCE</a>($ce),
        courseName =&gt; $courseID,
    });
    
<span class="preprocessor">    # if course directory doesn&#39;t exist, we don&#39;t have to do anything</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless -e $ce2-&gt;{courseDirs}{root};
    
<span class="preprocessor">    # temporary name for course</span>
<span class="preprocessor"></span>    my $tmpCourseID = <span class="stringliteral">&quot;${courseID}_tmp&quot;</span>;
    
    debug(<span class="stringliteral">&quot;Temporarily moving $courseID to $tmpCourseID to make room for course unarchiving&quot;</span>);
    <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a2a2bce56a70f92f98083334ff00c1de1">renameCourse</a>(
        courseID    =&gt; $courseID,
        ce          =&gt; $ce2,
        newCourseID =&gt; $tmpCourseID,
    );
    
<span class="preprocessor">    # course environment for after the course is moved</span>
<span class="preprocessor"></span>    my $ce3 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a46517fa1f6f6b35f4e7d03c6884e608b">get_SeedCE</a>($ce),
        courseName =&gt; $tmpCourseID,
    });
    
<span class="preprocessor">    # data to pass to renameCourse when moving the course back to it&#39;s original name</span>
<span class="preprocessor"></span>    my $restore_course_data = {
        courseID    =&gt; $tmpCourseID,
        ce          =&gt; $ce3, # course environment <span class="keywordflow">for</span> moved course
        newCourseID =&gt; $courseID,
    };
    
    <span class="keywordflow">return</span> $restore_course_data;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afe72cbd318c5f127b81bfbda8065a87e"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::_unarchiveCourse_move_back" ref="afe72cbd318c5f127b81bfbda8065a87e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">private method WeBWorK::Utils::CourseManagement::_unarchiveCourse_move_back </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-_unarchiveCourse_move_back' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-_unarchiveCourse_move_back-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_unarchiveCourse_move_back-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_unarchiveCourse_move_back-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in _unarchiveCourse_move_back: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#afe72cbd318c5f127b81bfbda8065a87e">_unarchiveCourse_move_back</a> {
    my ($restore_course_data) = @_;
    
    <span class="keywordflow">return</span> unless $restore_course_data;
    
    debug(<span class="stringliteral">&quot;Moving $$restore_course_data{courseID} back to $$restore_course_data{newCourseID} after course unarchiving&quot;</span>);
    <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a2a2bce56a70f92f98083334ff00c1de1">renameCourse</a>(%$restore_course_data);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a26e19e2f0534444aa03878eb71636507"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::addCourse" ref="a26e19e2f0534444aa03878eb71636507" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::addCourse </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-addCourse' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-addCourse-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-addCourse-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-addCourse-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in addCourse: 143</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a26e19e2f0534444aa03878eb71636507">addCourse</a> {
    my (%options) = @_;
    
    my $courseID = $options{courseID};
    my $ce = $options{ce};
    my %courseOptions = %{ $options{courseOptions} };
    my %dbOptions = defined $options{dbOptions} ? %{ $options{dbOptions} } : ();
    my @users = exists $options{users} ? @{ $options{users} } : ();
    
<span class="preprocessor">    # get the database layout out of the options hash</span>
<span class="preprocessor"></span>    my $dbLayoutName = $courseOptions{dbLayoutName};
    
<span class="preprocessor">    # collect some data</span>
<span class="preprocessor"></span>    my $coursesDir = $ce-&gt;{webworkDirs}-&gt;{courses};
    my $courseDir = <span class="stringliteral">&quot;$coursesDir/$courseID&quot;</span>;
    
<span class="preprocessor">    # fail if the course already exists</span>
<span class="preprocessor"></span><span class="preprocessor">    # IMPORTANT: this must be the first check! if any check other than this one</span>
<span class="preprocessor"></span><span class="preprocessor">    # fails, CourseAdmin deletes the course!! Oh no!!!</span>
<span class="preprocessor"></span><span class="preprocessor">    # DO NOT CHANGE THE DIE MESSAGE -- CourseAdmin checks it to determine whether</span>
<span class="preprocessor"></span><span class="preprocessor">    # a course was partially created and should be deleted!</span>
<span class="preprocessor"></span><span class="preprocessor">    # FIXME -- this is bad, and addCourse should deal with cleaning up partially</span>
<span class="preprocessor"></span><span class="preprocessor">    # created courses itself</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (-e $courseDir) {
        croak <span class="stringliteral">&quot;$courseID: course exists&quot;</span>;
    }
    
<span class="preprocessor">    # fail if the course ID contains invalid characters</span>
<span class="preprocessor"></span>    croak <span class="stringliteral">&quot;Invalid characters in course ID: &#39;$courseID&#39; (valid characters are [-A-Za-z0-9_])&quot;</span>
        unless $courseID =~ m/^[-A-Za-z0-9_]*$/;
    
<span class="preprocessor">    # if we didn&#39;t get a database layout, use the default one</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (not defined $dbLayoutName) {
        $dbLayoutName = $ce-&gt;{dbLayoutName};
    }
    
<span class="preprocessor">    # fail if the database layout is invalid</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (not exists $ce-&gt;{dbLayouts}-&gt;{$dbLayoutName}) {
        croak <span class="stringliteral">&quot;$dbLayoutName: not found in \%dbLayouts&quot;</span>;
    }
    
<span class="preprocessor">    ##### step 1: create course directory structure #####</span>
<span class="preprocessor"></span>    
    my %courseDirs = %{$ce-&gt;{courseDirs}};
    
<span class="preprocessor">    # deal with root directory first -- if we can&#39;t create it, we have to give up.</span>
<span class="preprocessor"></span>    
    exists $courseDirs{root} or croak <span class="stringliteral">&quot;Can&#39;t create the course &#39;$courseID&#39; because no root directory is specified in the &#39;%courseDirs&#39; hash.&quot;</span>;
    my $root = $courseDirs{root};
    <span class="keyword">delete</span> $courseDirs{root};
    {
<span class="preprocessor">        # does the directory already exist?</span>
<span class="preprocessor"></span>        -e $root and croak <span class="stringliteral">&quot;Can&#39;t create the course &#39;$courseID&#39; because the root directory &#39;$root&#39; already exists.&quot;</span>;
<span class="preprocessor">        # is the parent directory writeable?</span>
<span class="preprocessor"></span>        my @rootElements = File::Spec-&gt;splitdir($root);
        pop @rootElements;
        my $rootParent = File::Spec-&gt;catdir(@rootElements);
        -w $rootParent or croak <span class="stringliteral">&quot;Can&#39;t create the course &#39;$courseID&#39; because the courses directory &#39;$rootParent&#39; is not writeable.&quot;</span>;
<span class="preprocessor">        # try to create it</span>
<span class="preprocessor"></span>        mkdir $root or croak <span class="stringliteral">&quot;Can&#39;t create the course &#39;$courseID&#39; becasue the root directory &#39;$root&#39; could not be created: $!.&quot;</span>;
    }
    
<span class="preprocessor">    # deal with the rest of the directories</span>
<span class="preprocessor"></span>    
    my @courseDirNames = sort { $courseDirs{$a} cmp $courseDirs{$b} } keys %courseDirs;
    <span class="keywordflow">foreach</span> my $courseDirName (@courseDirNames) {
        my $courseDir = File::Spec-&gt;canonpath($courseDirs{$courseDirName});
        
<span class="preprocessor">        # does the directory already exist?</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (-e $courseDir) {
            warn <span class="stringliteral">&quot;Can&#39;t create $courseDirName directory &#39;$courseDir&#39;, since it already exists. Using existing directory.\n&quot;</span>;
            next;
        }
        
<span class="preprocessor">        # is the parent directory writeable?</span>
<span class="preprocessor"></span>        my @courseDirElements = File::Spec-&gt;splitdir($courseDir);
        pop @courseDirElements;
        my $courseDirParent = File::Spec-&gt;catdir(@courseDirElements);
        unless (-w $courseDirParent) {
            warn <span class="stringliteral">&quot;Can&#39;t create $courseDirName directory &#39;$courseDir&#39;, since the parent directory is not writeable. You will have to create this directory manually.\n&quot;</span>;
            next;
        }
        
<span class="preprocessor">        # try to create it</span>
<span class="preprocessor"></span>        mkdir $courseDir or warn <span class="stringliteral">&quot;Failed to create $courseDirName directory &#39;$courseDir&#39;: $!. You will have to create this directory manually.\n&quot;</span>;
    }
    
<span class="preprocessor">    ##### step 2: create course database #####</span>
<span class="preprocessor"></span>    
    my $db = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1DB.html">WeBWorK::DB</a>($ce-&gt;{dbLayouts}-&gt;{$dbLayoutName});
    my $create_db_result = $db-&gt;create_tables;
    die <span class="stringliteral">&quot;$courseID: course database creation failed.\n&quot;</span> unless $create_db_result;
    
<span class="preprocessor">    ##### step 3: populate course database #####</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> ($ce-&gt;{dbLayouts}{$dbLayoutName}{user}{params}{non_native}) {
        debug(<span class="stringliteral">&quot;not adding users to the course database: &#39;user&#39; table is non-native.\n&quot;</span>);
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # see above</span>
<span class="preprocessor"></span><span class="preprocessor">        #my $db = WeBWorK::DB-&gt;new($ce-&gt;{dbLayouts}-&gt;{$dbLayoutName});</span>
<span class="preprocessor"></span>        
        <span class="keywordflow">foreach</span> my $userTriple (@users) {
            my ($User, $Password, $PermissionLevel) = @$userTriple;
            
            eval { $db-&gt;addUser($User)                       }; warn $@ <span class="keywordflow">if</span> $@;
            eval { $db-&gt;addPassword($Password)               }; warn $@ <span class="keywordflow">if</span> $@;
            eval { $db-&gt;addPermissionLevel($PermissionLevel) }; warn $@ <span class="keywordflow">if</span> $@;
        }
    }
    
<span class="preprocessor">    ##### step 4: write course.conf file #####</span>
<span class="preprocessor"></span>    
    my $courseEnvFile = $ce-&gt;{courseFiles}-&gt;{environment};
    open my $fh, <span class="stringliteral">&quot;&gt;&quot;</span>, $courseEnvFile
        or die <span class="stringliteral">&quot;failed to open $courseEnvFile for writing.\n&quot;</span>;
    <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a466be9538ed09bdd3458d0c1dc4f6720">writeCourseConf</a>($fh, $ce, %courseOptions);
    close $fh;
    
<span class="preprocessor">    ##### step 5: copy templates #####</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> (exists $options{templatesFrom}) {
        my $sourceCourse = $options{templatesFrom};
        my $sourceCE = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
            <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a46517fa1f6f6b35f4e7d03c6884e608b">get_SeedCE</a>($ce),
            courseName =&gt; $sourceCourse,        # <span class="keyword">override</span> courseName
        });
        my $sourceDir = $sourceCE-&gt;{courseDirs}-&gt;{templates};
        
        <span class="keywordflow">if</span> (-d $sourceDir) {
            my $destDir = $ce-&gt;{courseDirs}{templates};
            my $cp_cmd = <span class="stringliteral">&quot;2&gt;&amp;1 &quot;</span> . $ce-&gt;{externalPrograms}{cp} . <span class="stringliteral">&quot; -R &quot;</span> . shell_quote($sourceDir) . <span class="stringliteral">&quot;/* &quot;</span> . shell_quote($destDir);
            my $cp_out = readpipe $cp_cmd;
            <span class="keywordflow">if</span> ($?) {
                my $exit = $? &gt;&gt; 8;
                my $signal = $? &amp; 127;
                my $core = $? &amp; 128;
                warn <span class="stringliteral">&quot;Failed to copy templates from course &#39;$sourceCourse&#39; with command &#39;$cp_cmd&#39; (exit=$exit signal=$signal core=$core): $cp_out\n&quot;</span>;
            }
        } <span class="keywordflow">else</span> {
            warn <span class="stringliteral">&quot;Failed to copy templates from course &#39;$sourceCourse&#39;: templates directory &#39;$sourceDir&#39; does not exist.\n&quot;</span>;
        }
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1dc2740fc57733be708c89a7def1ef9e"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::archiveCourse" ref="a1dc2740fc57733be708c89a7def1ef9e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::archiveCourse </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-archiveCourse' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-archiveCourse-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-archiveCourse-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-archiveCourse-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in archiveCourse: 43</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a1dc2740fc57733be708c89a7def1ef9e">archiveCourse</a> {
    my (%options) = @_;
    my $courseID = $options{courseID};
    my $ce = $options{ce};
    
<span class="preprocessor">    # make sure the user isn&#39;t brain damaged</span>
<span class="preprocessor"></span>    croak <span class="stringliteral">&quot;The course environment supplied doesn&#39;t appear to match the course $courseID. Can&#39;t proceed&quot;</span>
        unless $ce-&gt;{courseName} eq $courseID;
    
<span class="preprocessor">    # grab some values we&#39;ll need</span>
<span class="preprocessor"></span>    my $course_dir = $ce-&gt;{courseDirs}{root};
    
<span class="preprocessor">    # tmp_archive_path is used as the target of the tar.gz operation</span>
<span class="preprocessor"></span><span class="preprocessor">    # After this is done the final tar.gz file is moved either to the course directory</span>
<span class="preprocessor"></span><span class="preprocessor">    # or the course/myCourse/templates   directory (when saving individual courses)</span>
<span class="preprocessor"></span><span class="preprocessor">    # this prevents us from tarring a directory to which we have just added a file</span>
<span class="preprocessor"></span><span class="preprocessor">    # see bug #2022 -- for error messages on some operating systems</span>
<span class="preprocessor"></span>    my $uuidStub = create_uuid_as_string();
    my $tmp_archive_path = $ce-&gt;{webworkDirs}{courses} . <span class="stringliteral">&quot;/ ${uuidStub}_$courseID.tar.gz&quot;</span>;
    my $data_dir = $ce-&gt;{courseDirs}{DATA};
    my $dump_dir = <span class="stringliteral">&quot;$data_dir/mysqldump&quot;</span>;
    my $archive_path;
    <span class="keywordflow">if</span> ( PGcore::not_null( $options{archive_path} ) ) {
        $archive_path = $options{archive_path};
    } <span class="keywordflow">else</span> {
        $archive_path = $ce-&gt;{webworkDirs}{courses} . <span class="stringliteral">&quot;/$courseID.tar.gz&quot;</span>;
    }
    
    
<span class="preprocessor">    # fail if the source course does not exist</span>
<span class="preprocessor"></span>    unless (-e $course_dir) {
        croak <span class="stringliteral">&quot;$courseID: course not found&quot;</span>;
    }
    
<span class="preprocessor">    # replace previous archived file if it exists.</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (-e $archive_path) {
        unlink($archive_path) if (-w $archive_path);
        unless (-e $archive_path) {
            print CGI::p({-style=&gt;<span class="stringliteral">&#39;color:red; font-weight:bold&#39;</span>}, <span class="stringliteral">&quot;The archival version of &#39;$courseID&#39; has been replaced&#39;.\n&quot;</span>);
        } <span class="keywordflow">else</span> {
            croak <span class="stringliteral">&quot;Unable to replace the archival version of &#39;$courseID&#39;&quot;</span>;
        }
    }
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a58e22d09c07dc244f0891d46fcee737c"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::archiveCourseHelper" ref="a58e22d09c07dc244f0891d46fcee737c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::archiveCourseHelper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-archiveCourseHelper' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-archiveCourseHelper-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-archiveCourseHelper-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-archiveCourseHelper-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in archiveCourseHelper: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a58e22d09c07dc244f0891d46fcee737c">archiveCourseHelper</a> {
    my ($courseID, $ce, $dbLayoutName, %options) = @_;
    my $result = <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a61c4e546ef87db717ebaca66cc3ee13f">callHelperIfExists</a>(<span class="stringliteral">&quot;archiveCourseHelper&quot;</span>, $dbLayoutName, @_);
    <span class="keywordflow">return</span> $result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a61c4e546ef87db717ebaca66cc3ee13f"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::callHelperIfExists" ref="a61c4e546ef87db717ebaca66cc3ee13f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::callHelperIfExists </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-callHelperIfExists' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-callHelperIfExists-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-callHelperIfExists-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-callHelperIfExists-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in callHelperIfExists: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a61c4e546ef87db717ebaca66cc3ee13f">callHelperIfExists</a> {
    my ($helperName, $dbLayoutName, @args) = @_;
    
    my $helperRef = <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a9f005a4c2b8a0af7f864ddac37cc4b82">getHelperRef</a>($helperName, $dbLayoutName);
    <span class="keywordflow">if</span> (ref $helperRef) {
        <span class="keywordflow">return</span> $helperRef-&gt;(@args);
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">return</span> $helperRef;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a09aafa3576522f17b65b9ef6e8e42bc8"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::dbLayoutSQLSources" ref="a09aafa3576522f17b65b9ef6e8e42bc8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::dbLayoutSQLSources </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-dbLayoutSQLSources' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-dbLayoutSQLSources-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-dbLayoutSQLSources-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-dbLayoutSQLSources-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in dbLayoutSQLSources: 48</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a09aafa3576522f17b65b9ef6e8e42bc8">dbLayoutSQLSources</a> {
    my ($dbLayout) = @_;
    
    my %dbLayout = %$dbLayout;
    my @tables = keys %dbLayout;
    
    my %sources;
    
    <span class="keywordflow">foreach</span> my $table (@tables) {
        my %table = %{ $dbLayout{$table} };
        my %params = %{ $table{params} };
        
        <span class="keywordflow">if</span> ($params{non_native}) {
            debug(<span class="stringliteral">&quot;$table: marked non-native, skipping\n&quot;</span>);
            next;
        }
        
        my $source = $table{source};
        my $username = $params{username};
        my $password = $params{password};
        
        push @{$sources{$source}{tables}}, $table;
        
        <span class="keywordflow">if</span> (defined $sources{$source}{username}) {
            <span class="keywordflow">if</span> ($sources{$source}{username} ne $username) {
                warn <span class="stringliteral">&quot;conflicting usernames for source &#39;$source&#39;:&quot;</span>,
                    <span class="stringliteral">&quot; &#39;$sources{$source}{username}&#39;, &#39;$username&#39;\n&quot;</span>;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # it&#39;s all good</span>
<span class="preprocessor"></span>            }
        } <span class="keywordflow">else</span> {
            $sources{$source}{username} = $username;
        }
        
        <span class="keywordflow">if</span> (defined $sources{$source}{password}) {
            <span class="keywordflow">if</span> ($sources{$source}{password} ne $password) {
                warn <span class="stringliteral">&quot;conflicting passwords for source &#39;$source&#39;:&quot;</span>,
                    <span class="stringliteral">&quot; &#39;$sources{$source}{password}&#39;, &#39;$password&#39;\n&quot;</span>;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # it&#39;s all good</span>
<span class="preprocessor"></span>            }
        } <span class="keywordflow">else</span> {
            $sources{$source}{password} = $password;
        }
    }
    
    <span class="keywordflow">return</span> %sources;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="adba87e54c53b8e9451464b72ce43bf26"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::deleteCourse" ref="adba87e54c53b8e9451464b72ce43bf26" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::deleteCourse </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-deleteCourse' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-deleteCourse-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-deleteCourse-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-deleteCourse-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in deleteCourse: 69</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#adba87e54c53b8e9451464b72ce43bf26">deleteCourse</a> {
    my (%options) = @_;
    
    my $courseID = $options{courseID};
    my $ce = $options{ce};
    my %dbOptions = defined $options{dbOptions} ? %{ $options{dbOptions} } : ();
    
<span class="preprocessor">    # make sure the user isn&#39;t brain damaged</span>
<span class="preprocessor"></span>    die <span class="stringliteral">&quot;the course environment supplied doesn&#39;t appear to describe the course $courseID. can&#39;t proceed.&quot;</span>
        unless $ce-&gt;{courseName} eq $courseID;
    
    my %courseDirs = %{$ce-&gt;{courseDirs}};
    
<span class="preprocessor">    ##### step 0: make sure course directory is deleteable #####</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # deal with root directory first -- if we won&#39;t be able to delete it, we have to give up.</span>
<span class="preprocessor"></span>    
    exists $courseDirs{root} or croak <span class="stringliteral">&quot;Can&#39;t delete the course &#39;$courseID&#39; because no root directory is specified in the &#39;%courseDirs&#39; hash.&quot;</span>;
    my $root = $courseDirs{root};
    <span class="keywordflow">if</span> (-e $root) {
<span class="preprocessor">        # is the parent directory writeable?</span>
<span class="preprocessor"></span>        my @rootElements = File::Spec-&gt;splitdir($root);
        pop @rootElements;
        my $rootParent = File::Spec-&gt;catdir(@rootElements);
        -w $rootParent or croak <span class="stringliteral">&quot;Can&#39;t delete the course &#39;$courseID&#39; because the courses directory &#39;$rootParent&#39; is not writeable.&quot;</span>;
    } <span class="keywordflow">else</span> {
        warn <span class="stringliteral">&quot;Warning: the course root directory &#39;$root&#39; does not exist. Attempting to delete the course database and other course directories...\n&quot;</span>;
    }
    
<span class="preprocessor">    ##### step 1: delete course database (if necessary) #####</span>
<span class="preprocessor"></span>    
    my $dbLayoutName = $ce-&gt;{dbLayoutName};
    my $db = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1DB.html">WeBWorK::DB</a>($ce-&gt;{dbLayouts}-&gt;{$dbLayoutName});
    my $create_db_result = $db-&gt;delete_tables;
    die <span class="stringliteral">&quot;$courseID: course database deletion failed.\n&quot;</span> unless $create_db_result;
    
<span class="preprocessor">    ##### step 2: delete course directory structure #####</span>
<span class="preprocessor"></span>    
    my @courseDirNames = sort { $courseDirs{$a} cmp $courseDirs{$b} } keys %courseDirs;
    <span class="keywordflow">foreach</span> my $courseDirName (@courseDirNames) {
        my $courseDir = File::Spec-&gt;canonpath($courseDirs{$courseDirName});
        <span class="keywordflow">if</span> (-e $courseDir) {
            debug(<span class="stringliteral">&quot;courseDir $courseDir still exists. might delete it...\n&quot;</span>);
            
<span class="preprocessor">            # check for a few likely error conditions, since the mv error is not that helpful</span>
<span class="preprocessor"></span>            
<span class="preprocessor">            # is it really a directory</span>
<span class="preprocessor"></span>            unless (-d $courseDir) {
                warn <span class="stringliteral">&quot;Can&#39;t delete $courseDirName directory &#39;$courseDir&#39;, since is not a directory. If it is not wanted, you will have to delete it manually.\n&quot;</span>;
                next;
            }
            
<span class="preprocessor">            # is the parent writeable</span>
<span class="preprocessor"></span>            my @courseDirElements = File::Spec-&gt;splitdir($courseDir);
            pop @courseDirElements;
            my $courseDirParent = File::Spec-&gt;catdir(@courseDirElements);
            unless (-w $courseDirParent) {
                warn <span class="stringliteral">&quot;Can&#39;t delete $courseDirName directory &#39;$courseDir&#39;, since its parent directory is not writeable. If it is not wanted, you will have to delete it manually.\n&quot;</span>;
                next;
            }
            
<span class="preprocessor">            # try to delete the directory</span>
<span class="preprocessor"></span>            debug(<span class="stringliteral">&quot;Going to delete $courseDir...\n&quot;</span>);
            rmtree($courseDir, 0, 1);
        } <span class="keywordflow">else</span> {
            debug(<span class="stringliteral">&quot;courseDir $courseDir was already deleted.\n&quot;</span>);
        }
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a46517fa1f6f6b35f4e7d03c6884e608b"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::get_SeedCE" ref="a46517fa1f6f6b35f4e7d03c6884e608b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::get_SeedCE </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_SeedCE' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-get_SeedCE-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_SeedCE-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_SeedCE-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in get_SeedCE: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a46517fa1f6f6b35f4e7d03c6884e608b">get_SeedCE</a> {     # helper subroutine to produce a stripped down seed Course Environment from an arbitrary course environment
    my $ce = shift;
    warn <span class="stringliteral">&quot;get_SeedCE needs current Course environment to create seed CE&quot;</span> unless ref($ce) ;
    my %seedCE=();
    my @conf_items = qw( webwork_dir webwork_url pg_dir courseName)   ;  # items to transfer. courseName is often overridden
    <span class="keywordflow">foreach</span> my $item (@conf_items) {
            $seedCE{$item} = $ce-&gt;{$item};
    }
    <span class="keywordflow">return</span>( %seedCE);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9f005a4c2b8a0af7f864ddac37cc4b82"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::getHelperRef" ref="a9f005a4c2b8a0af7f864ddac37cc4b82" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::getHelperRef </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getHelperRef' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getHelperRef-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getHelperRef-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getHelperRef-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getHelperRef: 29</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a9f005a4c2b8a0af7f864ddac37cc4b82">getHelperRef</a> {
    my ($helperName, $dbLayoutName) = @_;
    
    my $result;
    
    my $package = __PACKAGE__ . <span class="stringliteral">&quot;::$dbLayoutName&quot;</span>;
    
    eval { <a class="code" href="classWeBWorK_1_1Utils.html#a6662b8474a5bfd16c7b4efe4d817a8ee">runtime_use</a> $package };
    <span class="keywordflow">if</span> ($@) {
        <span class="keywordflow">if</span> ($@ =~ /^Can<span class="stringliteral">&#39;t locate/) {</span>
<span class="stringliteral">            debug(&quot;No database-layout specific library for layout &#39;</span>$dbLayoutName<span class="stringliteral">&#39;.\n&quot;);</span>
<span class="stringliteral">            $result = 1;</span>
<span class="stringliteral">        } else {</span>
<span class="stringliteral">            warn &quot;Failed to load database-layout specific library: $@\n&quot;;</span>
<span class="stringliteral">            $result = 0;</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">    } else {</span>
<span class="stringliteral">        my %syms = do { no strict &#39;</span>refs<span class="stringliteral">&#39;; %{$package.&quot;::&quot;} };</span>
<span class="stringliteral">        if (exists $syms{$helperName}) {</span>
<span class="stringliteral">            $result = do { no strict &#39;</span>refs<span class="stringliteral">&#39;; \&amp;{$package.&quot;::&quot;.$helperName} };</span>
<span class="stringliteral">        } else {</span>
<span class="stringliteral">            debug(&quot;No helper defined for operation &#39;</span>$helperName<span class="stringliteral">&#39;.\n&quot;);</span>
<span class="stringliteral">            $result = 1;</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    #warn &quot;getHelperRef = &#39;</span>$result<span class="stringliteral">&#39;\n&quot;;</span>
<span class="stringliteral">    return $result;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3835076848ebaee14d69059aa8d03f39"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::initNonNativeTables" ref="a3835076848ebaee14d69059aa8d03f39" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::initNonNativeTables </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-initNonNativeTables' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-initNonNativeTables-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-initNonNativeTables-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-initNonNativeTables-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in initNonNativeTables: 34</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a3835076848ebaee14d69059aa8d03f39">initNonNativeTables</a> {
    my($ce, $dbLayoutName, %options) = @_;
    my $str = <span class="stringliteral">&#39;&#39;</span>;
<span class="preprocessor">    # Create a database handler</span>
<span class="preprocessor"></span>    my $db = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1DB.html">WeBWorK::DB</a>($ce-&gt;{dbLayouts}-&gt;{$dbLayoutName});
    
<span class="preprocessor">     # lock database</span>
<span class="preprocessor"></span>     
<span class="preprocessor">    # Find the names of the non-native database tables </span>
<span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $table (sort keys %$db) {
        next unless $db-&gt;{$table}{params}{non_native}; # only look at non-native tables
        my $database_table_name = (exists $db-&gt;{$table}-&gt;{params}-&gt;{tableOverride})? $db-&gt;{$table}-&gt;{params}-&gt;{tableOverride}:$table;
<span class="preprocessor">        #warn &quot;table is $table&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        #warn &quot;checking $database_table_name&quot;;</span>
<span class="preprocessor"></span>        my $database_table_exists = ($db-&gt;{$table}-&gt;tableExists) ? 1:0;
        unless ($database_table_exists ) { # exists means the table can be described;
            my $schema_obj = $db-&gt;{$table};
            <span class="keywordflow">if</span> ($schema_obj-&gt;can(<span class="stringliteral">&quot;create_table&quot;</span>)) {
<span class="preprocessor">                #warn &quot;creating table $database_table_name  with object $schema_obj&quot;;</span>
<span class="preprocessor"></span>                $schema_obj-&gt;create_table;
                $str .= <span class="stringliteral">&quot;Table &#39;$table&#39; created as &#39;$database_table_name&#39; in database.&quot;</span>.CGI::br();
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # warn &quot;Skipping creation of &#39;$table&#39; table: no create_table method\n&quot;;</span>
<span class="preprocessor"></span>            }
        
        }
       
    }
    
<span class="preprocessor">    # unlock database</span>
<span class="preprocessor"></span>    $str;


}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a851e3da30c00e369bcb2ef0e8f2d93c4"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::listArchivedCourses" ref="a851e3da30c00e369bcb2ef0e8f2d93c4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::listArchivedCourses </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-listArchivedCourses' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-listArchivedCourses-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-listArchivedCourses-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-listArchivedCourses-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in listArchivedCourses: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a851e3da30c00e369bcb2ef0e8f2d93c4">listArchivedCourses</a> {
    my ($ce) = @_;
    my $coursesDir = $ce-&gt;{webworkDirs}-&gt;{courses};
    <span class="keywordflow">return</span> grep { m/\.tar\.gz$/ } <a class="code" href="classWeBWorK_1_1Utils.html#a908ab95f2f3b2874c63969f6da72877c">readDirectory</a>($coursesDir);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aaecb3b19f9fe81b07409176e7fa7f043"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::listCourses" ref="aaecb3b19f9fe81b07409176e7fa7f043" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::listCourses </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-listCourses' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-listCourses-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-listCourses-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-listCourses-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in listCourses: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aaecb3b19f9fe81b07409176e7fa7f043">listCourses</a> {
    my ($ce) = @_;
    my $coursesDir = $ce-&gt;{webworkDirs}-&gt;{courses};
    <span class="keywordflow">return</span> grep { not (m/^\./ or m/^CVS$/) and -d &quot;$coursesDir/$_&quot; } <a class="code" href="classWeBWorK_1_1Utils.html#a908ab95f2f3b2874c63969f6da72877c">readDirectory</a>($coursesDir);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aebe71be9cac592f0ba02c1df9e7192f1"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::protectQString" ref="aebe71be9cac592f0ba02c1df9e7192f1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::protectQString </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-protectQString' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-protectQString-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-protectQString-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-protectQString-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in protectQString: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aebe71be9cac592f0ba02c1df9e7192f1">protectQString</a> {
    my ($string) = @_;
    $string =~ s/<span class="stringliteral">&#39;/\&#39;/g;</span>
<span class="stringliteral">    return $string;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2a2bce56a70f92f98083334ff00c1de1"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::renameCourse" ref="a2a2bce56a70f92f98083334ff00c1de1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::renameCourse </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-renameCourse' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-renameCourse-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-renameCourse-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-renameCourse-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in renameCourse: 123</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a2a2bce56a70f92f98083334ff00c1de1">renameCourse</a> {
    my (%options) = @_;
    
<span class="preprocessor">    # renameCourseHelper needs:</span>
<span class="preprocessor"></span><span class="preprocessor">    #    $fromCourseID ($oldCourseID)</span>
<span class="preprocessor"></span><span class="preprocessor">    #    $fromCE ($oldCE)</span>
<span class="preprocessor"></span><span class="preprocessor">    #    $toCourseID ($newCourseID)</span>
<span class="preprocessor"></span><span class="preprocessor">    #    $toCE (construct from $oldCE)</span>
<span class="preprocessor"></span><span class="preprocessor">    #    $dbLayoutName ($oldCE-&gt;{dbLayoutName})</span>
<span class="preprocessor"></span><span class="preprocessor">    #    %options ($dbOptions)</span>
<span class="preprocessor"></span>    
    my $oldCourseID = $options{courseID};
    my $oldCE = $options{ce};
    my %dbOptions = defined $options{dbOptions} ? %{ $options{dbOptions} } : ();
    my $newCourseID = $options{newCourseID};
    my $skipDBRename = $options{skipDBRename} || 0;
    
<span class="preprocessor">    # get the database layout out of the options hash</span>
<span class="preprocessor"></span>    my $dbLayoutName = $oldCE-&gt;{dbLayoutName};
    
<span class="preprocessor">    # collect some data</span>
<span class="preprocessor"></span>    my $coursesDir = $oldCE-&gt;{webworkDirs}-&gt;{courses};
    my $oldCourseDir = <span class="stringliteral">&quot;$coursesDir/$oldCourseID&quot;</span>;
    my $newCourseDir = <span class="stringliteral">&quot;$coursesDir/$newCourseID&quot;</span>;
    
<span class="preprocessor">    # fail if the target course already exists</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (-e $newCourseDir) {
        croak <span class="stringliteral">&quot;$newCourseID: course exists&quot;</span>;
    }
    
<span class="preprocessor">    # fail if the source course does not exist</span>
<span class="preprocessor"></span>    unless (-e $oldCourseDir) {
        croak <span class="stringliteral">&quot;$oldCourseID: course not found&quot;</span>;
    }
    
<span class="preprocessor">    ##### step 1: move course directory #####</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # move top-level course directory</span>
<span class="preprocessor"></span>    my $mv_cmd = <span class="stringliteral">&quot;2&gt;&amp;1&quot;</span>.<span class="stringliteral">&quot; &quot;</span>.$oldCE-&gt;{externalPrograms}{mv}.<span class="stringliteral">&quot; &quot;</span>.shell_quote($oldCourseDir).<span class="stringliteral">&quot; &quot;</span>.shell_quote($newCourseDir);
    debug(<span class="stringliteral">&quot;moving course dir: $mv_cmd&quot;</span>);
    my $mv_out = readpipe $mv_cmd;
    <span class="keywordflow">if</span> ($?) {
        my $exit = $? &gt;&gt; 8;
        my $signal = $? &amp; 127;
        my $core = $? &amp; 128;
        die <span class="stringliteral">&quot;Failed to move course directory with command &#39;$mv_cmd&#39; (exit=$exit signal=$signal core=$core): $mv_out\n&quot;</span>;
    }
    
<span class="preprocessor">    # get new course environment</span>
<span class="preprocessor"></span>    my $newCE = $oldCE-&gt;new(
        $oldCE-&gt;{webworkDirs}-&gt;{root},
        $oldCE-&gt;{webworkURLs}-&gt;{root},
        $oldCE-&gt;{pg}-&gt;{directories}-&gt;{root},
        $newCourseID,
    );
    
<span class="preprocessor">    # find the course dirs that still exist in their original locations</span>
<span class="preprocessor"></span><span class="preprocessor">    # (i.e. are not subdirs of $courseDir)</span>
<span class="preprocessor"></span>    my %oldCourseDirs = %{ $oldCE-&gt;{courseDirs} };
    my %newCourseDirs = %{ $newCE-&gt;{courseDirs} };
    my @courseDirNames = sort { $oldCourseDirs{$a} cmp $oldCourseDirs{$b} } keys %oldCourseDirs;
    <span class="keywordflow">foreach</span> my $courseDirName (@courseDirNames) {
        my $oldDir = File::Spec-&gt;canonpath($oldCourseDirs{$courseDirName});
        my $newDir = File::Spec-&gt;canonpath($newCourseDirs{$courseDirName});
        <span class="keywordflow">if</span> (-e $oldDir) {
            debug(<span class="stringliteral">&quot;oldDir $oldDir still exists. might move it...\n&quot;</span>);
            
<span class="preprocessor">            # check for a few likely error conditions, since the mv error is not that helpful</span>
<span class="preprocessor"></span>            
<span class="preprocessor">            # is the source really a directory</span>
<span class="preprocessor"></span>            unless (-d $oldDir) {
                warn <span class="stringliteral">&quot;$courseDirName: Can&#39;t move &#39;$oldDir&#39; to &#39;$newDir&#39;, since the source is not a directory. You will have to move this directory manually.\n&quot;</span>;
                next;
            }
            
<span class="preprocessor">            # does the destination already exist?</span>
<span class="preprocessor"></span><span class="preprocessor">            # (this should only happen on extra-coursedir directories, since we make sure the root dir doesn&#39;t exist above.)</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> (-e $newDir) {
                warn <span class="stringliteral">&quot;$courseDirName: Can&#39;t move &#39;$oldDir&#39; to &#39;$newDir&#39;, since the target already exists. You will have to move this directory manually.\n&quot;</span>;
                next;
            }
            
<span class="preprocessor">            # is oldDir&#39;s parent writeable</span>
<span class="preprocessor"></span>            my @oldDirElements = File::Spec-&gt;splitdir($oldDir);
            pop @oldDirElements;
            my $oldDirParent = File::Spec-&gt;catdir(@oldDirElements);
            unless (-w $oldDirParent) {
                warn <span class="stringliteral">&quot;$courseDirName: Can&#39;t move &#39;$oldDir&#39; to &#39;$newDir&#39;, since the source parent directory is not writeable. You will have to move this directory manually.\n&quot;</span>;
                next;
            }
            
<span class="preprocessor">            # is newDir&#39;s parent writeable?</span>
<span class="preprocessor"></span>            my @newDirElements = File::Spec-&gt;splitdir($newDir);
            pop @newDirElements;
            my $newDirParent = File::Spec-&gt;catdir(@newDirElements);
            unless (-w $newDirParent) {
                warn <span class="stringliteral">&quot;$courseDirName: Can&#39;t move &#39;$oldDir&#39; to &#39;$newDir&#39;, since the destination parent directory is not writeable. You will have to move this directory manually.\n&quot;</span>;
                next;
            }
            
<span class="preprocessor">            # try to move the directory</span>
<span class="preprocessor"></span>            debug(<span class="stringliteral">&quot;Going to move $oldDir to $newDir...\n&quot;</span>);
            my $mv_cmd = <span class="stringliteral">&quot;2&gt;&amp;1&quot;</span>.<span class="stringliteral">&quot; &quot;</span>.$oldCE-&gt;{externalPrograms}{mv}.<span class="stringliteral">&quot; &quot;</span>.shell_quote($oldDir).<span class="stringliteral">&quot; &quot;</span>.shell_quote($newDir);
            my $mv_out = readpipe $mv_cmd;
            <span class="keywordflow">if</span> ($?) {
                my $exit = $? &gt;&gt; 8;
                my $signal = $? &amp; 127;
                my $core = $? &amp; 128;
                warn <span class="stringliteral">&quot;Failed to move directory with command &#39;$mv_cmd&#39; (exit=$exit signal=$signal core=$core): $mv_out\n&quot;</span>;
            }
        } <span class="keywordflow">else</span> {
            debug(<span class="stringliteral">&quot;oldDir $oldDir was already moved.\n&quot;</span>);
        }
    }
    
<span class="preprocessor">    ##### step 2: rename database #####</span>
<span class="preprocessor"></span>    
    unless ($skipDBRename) {
        my $oldDB = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1DB.html">WeBWorK::DB</a>($oldCE-&gt;{dbLayouts}{$dbLayoutName});
        my $rename_db_result = $oldDB-&gt;rename_tables($newCE-&gt;{dbLayouts}{$dbLayoutName});
        die <span class="stringliteral">&quot;$oldCourseID: course database renaming failed.\n&quot;</span> unless $rename_db_result;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3aa5b9e1b4490cb3a4b4af62e518039c"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::unarchiveCourse" ref="a3aa5b9e1b4490cb3a4b4af62e518039c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::unarchiveCourse </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unarchiveCourse' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unarchiveCourse-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unarchiveCourse-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unarchiveCourse-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unarchiveCourse: 101</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a3aa5b9e1b4490cb3a4b4af62e518039c">unarchiveCourse</a> {
    my (%options) = @_;
    
    my $newCourseID = $options{newCourseID};
    my $currCourseID = $options{oldCourseID};
    my $archivePath = $options{archivePath};
    my $ce = $options{ce};
    
    my $coursesDir  = $ce-&gt;{webworkDirs}{courses};
    
<span class="preprocessor">    # Double check that the new course does not exist</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (-e <span class="stringliteral">&quot;$coursesDir/$newCourseID&quot;</span>) {
        die <span class="stringliteral">&quot;Cannot overwrite existing course $coursesDir/$newCourseID&quot;</span>;
    }
    
<span class="preprocessor">    ##### step 1: move a conflicting course away #####</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # if this function returns undef, it means there was no course in the way</span>
<span class="preprocessor"></span>    my $restoreCourseData = <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a23b10750a7f6467d53355bc9ceb75f83">_unarchiveCourse_move_away</a>($ce, $currCourseID);
    
<span class="preprocessor">    ##### step 2: crack open the tarball #####</span>
<span class="preprocessor"></span>    
    my $tar_cmd = <span class="stringliteral">&quot;2&gt;&amp;1 &quot;</span> . $ce-&gt;{externalPrograms}{tar}
        . <span class="stringliteral">&quot; -C &quot;</span> . shell_quote($coursesDir)
        . <span class="stringliteral">&quot; -xzf &quot;</span> . shell_quote($archivePath);
    my $tar_out = readpipe $tar_cmd;
    <span class="keywordflow">if</span> ($?) {
        my $exit = $? &gt;&gt; 8;
        my $signal = $? &amp; 127;
        my $core = $? &amp; 128;
        <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#afe72cbd318c5f127b81bfbda8065a87e">_unarchiveCourse_move_back</a>($restoreCourseData);
        die <span class="stringliteral">&quot;Failed to unarchive course directory with command &#39;$tar_cmd&#39; (exit=$exit signal=$signal core=$core): $tar_out\n&quot;</span>;
    }
    
<span class="preprocessor">    ##### step 3: read the course environment for this course #####</span>
<span class="preprocessor"></span>    
    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a46517fa1f6f6b35f4e7d03c6884e608b">get_SeedCE</a>($ce),
        courseName =&gt; $currCourseID,
    });
    
<span class="preprocessor">    # pull out some useful stuff</span>
<span class="preprocessor"></span>    my $course_dir = $ce2-&gt;{courseDirs}{root};
    my $data_dir = $ce2-&gt;{courseDirs}{DATA};
    my $dump_dir = <span class="stringliteral">&quot;$data_dir/mysqldump&quot;</span>;
    my $old_dump_file = <span class="stringliteral">&quot;$data_dir/${currCourseID}_mysql.database&quot;</span>;
    
<span class="preprocessor">    ##### step 4: restore the database tables #####</span>
<span class="preprocessor"></span>    
    my $no_database;
    my $restore_db_result = 1;
    <span class="keywordflow">if</span> (-e $dump_dir) {
        my $db = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1DB.html">WeBWorK::DB</a>($ce2-&gt;{dbLayout});
        $restore_db_result = $db-&gt;restore_tables($dump_dir);
    } elsif (-e $old_dump_file) {
        my $dbLayoutName = $ce2-&gt;{dbLayoutName};
        <span class="keywordflow">if</span> (ref <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a9f005a4c2b8a0af7f864ddac37cc4b82">getHelperRef</a>(<span class="stringliteral">&quot;unarchiveCourseHelper&quot;</span>, $dbLayoutName)) {
            eval {
                $restore_db_result = <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a885849d795b1ed78a5755453ebb72d51">unarchiveCourseHelper</a>($currCourseID, $ce2, $dbLayoutName,
                    unarchiveDatabasePath=&gt;$old_dump_file);
            };
            <span class="keywordflow">if</span> ($@) {
                warn <span class="stringliteral">&quot;failed to unarchive course database from dump file &#39;$old_dump_file: $@\n&quot;</span>;
            }
        } <span class="keywordflow">else</span> {
            warn <span class="stringliteral">&quot;course &#39;$currCourseID&#39; uses dbLayout &#39;$dbLayoutName&#39;, which doesn&#39;t support restoring database tables. database tables will not be restored.\n&quot;</span>;
            $no_database = 1;
        }
    } <span class="keywordflow">else</span> {
        warn <span class="stringliteral">&quot;course &#39;$currCourseID&#39; has no database dump in its data directory (checked for $dump_dir and $old_dump_file). database tables will not be restored.\n&quot;</span>;
        $no_database = 1;
    }
    
    unless ($restore_db_result) {
        warn <span class="stringliteral">&quot;database restore of course &#39;$currCourseID&#39; failed: the course will probably not be usable.\n&quot;</span>;
    }
    
<span class="preprocessor">    ##### step 5: delete dump_dir and/or old_dump_file #####</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> (-e $dump_dir) {
        <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a0cc737c6a9b300bc925a18ceb9c5a8cb">_archiveCourse_remove_dump_dir</a>($ce, $dump_dir);
    }
    <span class="keywordflow">if</span> (-e $old_dump_file) {
        unlink $old_dump_file or carp <span class="stringliteral">&quot;Failed to unlink course database dump file &#39;$old_dump_file: $_\n&quot;</span>;
    }
    
<span class="preprocessor">    ##### step 6: rename course #####</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> (defined $newCourseID and $newCourseID ne $currCourseID) {
        <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a2a2bce56a70f92f98083334ff00c1de1">renameCourse</a>(
            courseID     =&gt; $currCourseID,
            ce           =&gt; $ce2,
            newCourseID  =&gt; $newCourseID,
            skipDBRename =&gt; $no_database,
        );
    }
    
<span class="preprocessor">    ##### step 7: return conflicting course to its rightful place #####</span>
<span class="preprocessor"></span>    
    <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#afe72cbd318c5f127b81bfbda8065a87e">_unarchiveCourse_move_back</a>($restoreCourseData);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a885849d795b1ed78a5755453ebb72d51"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::unarchiveCourseHelper" ref="a885849d795b1ed78a5755453ebb72d51" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::unarchiveCourseHelper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unarchiveCourseHelper' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unarchiveCourseHelper-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unarchiveCourseHelper-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unarchiveCourseHelper-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unarchiveCourseHelper: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a885849d795b1ed78a5755453ebb72d51">unarchiveCourseHelper</a> {
    my ($courseID, $ce, $dbLayoutName, %options) = @_;
    my $result = <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a61c4e546ef87db717ebaca66cc3ee13f">callHelperIfExists</a>(<span class="stringliteral">&quot;unarchiveCourseHelper&quot;</span>, $dbLayoutName, @_);
    <span class="keywordflow">return</span> $result;
}
</pre></div>  
</div>
 
<p>Reimplemented in <a class="el" href="classWeBWorK_1_1Utils_1_1CourseManagement_1_1sql__single.html#aab707f5c7077faf0b239e8c28d4ec624">WeBWorK::Utils::CourseManagement::sql_single</a>.</p>

</div>
</div>
<a class="anchor" id="a466be9538ed09bdd3458d0c1dc4f6720"></a><!-- doxytag: member="WeBWorK::Utils::CourseManagement::writeCourseConf" ref="a466be9538ed09bdd3458d0c1dc4f6720" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::CourseManagement::writeCourseConf </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-writeCourseConf' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-writeCourseConf-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-writeCourseConf-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-writeCourseConf-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in writeCourseConf: 140</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a466be9538ed09bdd3458d0c1dc4f6720">writeCourseConf</a> {
    my ($fh, $ce, %options) = @_;
    
<span class="preprocessor">    # several options should be defined no matter what</span>
<span class="preprocessor"></span>    $options{dbLayoutName} = $ce-&gt;{dbLayoutName} unless defined $options{dbLayoutName};
    
    print $fh &lt;&lt;<span class="stringliteral">&#39;EOF&#39;</span>;
<span class="preprocessor">#!perl</span>
<span class="preprocessor"></span><span class="preprocessor">################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># WeBWorK Online Homework Delivery System</span>
<span class="preprocessor"></span><span class="preprocessor"># Copyright  2000-2007 The WeBWorK Project, http://openwebwork.sf.net/</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor"># This program is free software; you can redistribute it and/or modify it under</span>
<span class="preprocessor"></span><span class="preprocessor"># the terms of either: (a) the GNU General Public License as published by the</span>
<span class="preprocessor"></span><span class="preprocessor"># Free Software Foundation; either version 2, or (at your option) any later</span>
<span class="preprocessor"></span><span class="preprocessor"># version, or (b) the &quot;Artistic License&quot; which comes with this package.</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor"># This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="preprocessor"></span><span class="preprocessor"># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="preprocessor"></span><span class="preprocessor"># FOR A PARTICULAR PURPOSE.  See either the GNU General Public License or the</span>
<span class="preprocessor"></span><span class="preprocessor"># Artistic License for more details.</span>
<span class="preprocessor"></span><span class="preprocessor">################################################################################</span>
<span class="preprocessor"></span>
<span class="preprocessor"># This file is used to override the global WeBWorK course environment for</span>
<span class="preprocessor"></span><span class="preprocessor"># requests to this course. All package variables set in this file are added to</span>
<span class="preprocessor"></span><span class="preprocessor"># the course environment. If you wish to set a variable here but omit it from</span>
<span class="preprocessor"></span><span class="preprocessor"># the course environment,  use the &quot;my&quot; keyword. Commonly changed configuration</span>
<span class="preprocessor"></span><span class="preprocessor"># options are noted below.</span>
<span class="preprocessor"></span>
EOF
    
    print $fh &lt;&lt;<span class="stringliteral">&#39;EOF&#39;</span>;
<span class="preprocessor"># Database Layout (global value typically defined in global.conf)</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor"># Several database are defined in the file conf/database.conf and stored in the</span>
<span class="preprocessor"></span><span class="preprocessor"># hash %dbLayouts.</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor"># The database layout is always set here, since one should be able to change the</span>
<span class="preprocessor"></span><span class="preprocessor"># default value in global.conf without disrupting existing courses.</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor"># global.conf values:</span>
<span class="preprocessor"></span>EOF
    
    print $fh <span class="stringliteral">&quot;# \t&quot;</span>, <span class="stringliteral">&#39;$dbLayoutName = \&#39;&#39;</span>, <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aebe71be9cac592f0ba02c1df9e7192f1">protectQString</a>($ce-&gt;{dbLayoutName}), <span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39;, &quot;\n&quot;;</span>
<span class="stringliteral">    print $fh &quot;# \t&quot;, &#39;</span>*dbLayout = $dbLayouts{$dbLayoutName};<span class="stringliteral">&#39;, &quot;\n&quot;;</span>
<span class="stringliteral">    print $fh &quot;\n&quot;;</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    if (defined $options{dbLayoutName}) {</span>
<span class="stringliteral">        print $fh &#39;</span>$dbLayoutName = \<span class="stringliteral">&#39;&#39;</span>, <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aebe71be9cac592f0ba02c1df9e7192f1">protectQString</a>($options{dbLayoutName}), <span class="charliteral">&#39;\&#39;</span>;<span class="stringliteral">&#39;, &quot;\n&quot;;</span>
<span class="stringliteral">        print $fh &#39;</span>*dbLayout = $dbLayouts{$dbLayoutName};<span class="stringliteral">&#39;, &quot;\n&quot;;</span>
<span class="stringliteral">        print $fh &quot;\n&quot;;</span>
<span class="stringliteral">    } else {</span>
<span class="stringliteral">        print $fh &quot;\n\n\n&quot;;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print $fh &lt;&lt;&#39;</span>EOF<span class="stringliteral">&#39;;</span>
<span class="stringliteral"># Allowed Mail Recipients (global value typically not defined)</span>
<span class="stringliteral"># </span>
<span class="stringliteral"># Defines addresses to which the PG system is allowed to send mail. This should</span>
<span class="stringliteral"># probably be set to the addresses of professors of this course. Sending mail</span>
<span class="stringliteral"># from the PG system (i.e. questionaires, essay questions) will fail if this is</span>
<span class="stringliteral"># not set.</span>
<span class="stringliteral"># </span>
<span class="stringliteral"># global.conf values:</span>
<span class="stringliteral">EOF</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    if (defined $ce-&gt;{mail}-&gt;{allowedRecipients}) {</span>
<span class="stringliteral">        print $fh &quot;# \t&quot;, &#39;</span>$mail{allowedRecipients} = [<span class="stringliteral">&#39;,</span>
<span class="stringliteral">                join(&quot;, &quot;, map { &quot;&#39;</span><span class="stringliteral">&quot; . protectQString($_) . &quot;</span><span class="stringliteral">&#39;&quot; } @{ $ce-&gt;{mail}-&gt;{allowedRecipients} }), &#39;</span>];<span class="stringliteral">&#39;, &quot;\n&quot;;</span>
<span class="stringliteral">    } else {</span>
<span class="stringliteral">        print $fh &quot;# \t&quot;, &#39;</span>$mail{allowedRecipients} = [  ];<span class="stringliteral">&#39;, &quot;\n&quot;;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    print $fh &quot;\n&quot;;</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    if (defined $options{allowedRecipients}) {</span>
<span class="stringliteral">        print $fh &#39;</span>$mail{allowedRecipients} = [<span class="stringliteral">&#39;,</span>
<span class="stringliteral">                join(&quot;, &quot;, map { &quot;&#39;</span><span class="stringliteral">&quot; . protectQString($_) . &quot;</span><span class="stringliteral">&#39;&quot; } @{ $options{allowedRecipients} }), &#39;</span>];<span class="stringliteral">&#39;, &quot;\n&quot;;</span>
<span class="stringliteral">        print $fh &quot;\n&quot;;</span>
<span class="stringliteral">    } else {</span>
<span class="stringliteral">        print $fh &quot;\n\n\n&quot;;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print $fh &lt;&lt;&#39;</span>EOF<span class="stringliteral">&#39;;</span>
<span class="stringliteral"># By default, feeback is sent to all users who have permission to</span>
<span class="stringliteral"># receive_feedback. If this list is non-empty, feedback is also sent to the</span>
<span class="stringliteral"># addresses specified here.</span>
<span class="stringliteral"># </span>
<span class="stringliteral"># * If you want to disable feedback altogether, leave this empty and set</span>
<span class="stringliteral">#   $permissionLevels{submit_feeback} = undef;</span>
<span class="stringliteral">#   This will cause the</span>
<span class="stringliteral">#   feedback button to go away as well.</span>
<span class="stringliteral"># </span>
<span class="stringliteral"># * If you want to send email ONLY to addresses in this list, set</span>
<span class="stringliteral">#   $permissionLevels{receive_feedback} = undef; </span>
<span class="stringliteral"># </span>
<span class="stringliteral"># It&#39;</span>s often useful to <span class="keyword">set</span> <span class="keyword">this</span> in the course.conf to change the behavior of
<span class="preprocessor"># feedback for a specific course.</span>
<span class="preprocessor"></span><span class="preprocessor"># global.conf values:</span>
<span class="preprocessor"></span>EOF
    
    <span class="keywordflow">if</span> (defined $ce-&gt;{mail}-&gt;{feedbackRecipients}) {
        print $fh <span class="stringliteral">&quot;# \t&quot;</span>, <span class="stringliteral">&#39;$mail{feedbackRecipients} = [&#39;</span>,
                join(<span class="stringliteral">&quot;, &quot;</span>, map { <span class="stringliteral">&quot;&#39;&quot;</span> . <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aebe71be9cac592f0ba02c1df9e7192f1">protectQString</a>($_) . <span class="stringliteral">&quot;&#39;&quot;</span> } @{ $ce-&gt;{mail}-&gt;{feedbackRecipients} }), <span class="stringliteral">&#39;];&#39;</span>, <span class="stringliteral">&quot;\n&quot;</span>;
    } <span class="keywordflow">else</span> {
        print $fh <span class="stringliteral">&quot;# \t&quot;</span>, <span class="stringliteral">&#39;$mail{feedbackRecipients} = [  ];&#39;</span>, <span class="stringliteral">&quot;\n&quot;</span>;
    }
    print $fh <span class="stringliteral">&quot;\n&quot;</span>;
    
    <span class="keywordflow">if</span> (defined $options{feedbackRecipients}) {
        print $fh <span class="stringliteral">&#39;$mail{feedbackRecipients} = [&#39;</span>,
                join(<span class="stringliteral">&quot;, &quot;</span>, map { <span class="stringliteral">&quot;&#39;&quot;</span> . <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aebe71be9cac592f0ba02c1df9e7192f1">protectQString</a>($_) . <span class="stringliteral">&quot;&#39;&quot;</span> } @{ $options{feedbackRecipients} }), <span class="stringliteral">&#39;];&#39;</span>, <span class="stringliteral">&quot;\n&quot;</span>;
        print $fh <span class="stringliteral">&quot;\n&quot;</span>;
    } <span class="keywordflow">else</span> {
        print $fh <span class="stringliteral">&quot;\n\n\n&quot;</span>;
    }
    
    print $fh &lt;&lt;<span class="stringliteral">&#39;EOF&#39;</span>;
<span class="preprocessor"># Users for whom to label problems with the PG file name (global value typically &quot;professor&quot;)</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor"># For users in this list, PG will display the source file name when rendering a problem.</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor"># global.conf values:</span>
<span class="preprocessor"></span>EOF
    
    <span class="keywordflow">if</span> (defined $ce-&gt;{pg}{specialPGEnvironmentVars}{PRINT_FILE_NAMES_FOR}) {
        print $fh <span class="stringliteral">&quot;# \t&quot;</span>, <span class="stringliteral">&#39;$pg{specialPGEnvironmentVars}{PRINT_FILE_NAMES_FOR} = [&#39;</span>,
                join(<span class="stringliteral">&quot;, &quot;</span>, map { <span class="stringliteral">&quot;&#39;&quot;</span> . <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aebe71be9cac592f0ba02c1df9e7192f1">protectQString</a>($_) . <span class="stringliteral">&quot;&#39;&quot;</span> } @{ $ce-&gt;{pg}{specialPGEnvironmentVars}{PRINT_FILE_NAMES_FOR} }), <span class="stringliteral">&#39;];&#39;</span>, <span class="stringliteral">&quot;\n&quot;</span>;
    } <span class="keywordflow">else</span> {
        print $fh <span class="stringliteral">&quot;# \t&quot;</span>, <span class="stringliteral">&#39;$pg{specialPGEnvironmentVars}{PRINT_FILE_NAMES_FOR} = [  ];&#39;</span>, <span class="stringliteral">&quot;\n&quot;</span>;
    }
    print $fh <span class="stringliteral">&quot;\n&quot;</span>;
    
    <span class="keywordflow">if</span> (defined $options{PRINT_FILE_NAMES_FOR}) {
        print $fh <span class="stringliteral">&#39;$pg{specialPGEnvironmentVars}{PRINT_FILE_NAMES_FOR} = [&#39;</span>,
                join(<span class="stringliteral">&quot;, &quot;</span>, map { <span class="stringliteral">&quot;&#39;&quot;</span> . <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#aebe71be9cac592f0ba02c1df9e7192f1">protectQString</a>($_) . <span class="stringliteral">&quot;&#39;&quot;</span> } @{ $options{PRINT_FILE_NAMES_FOR} }), <span class="stringliteral">&#39;];&#39;</span>, <span class="stringliteral">&quot;\n&quot;</span>;
        print $fh <span class="stringliteral">&quot;\n&quot;</span>;
    } <span class="keywordflow">else</span> {
        print $fh <span class="stringliteral">&quot;\n\n\n&quot;</span>;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="CourseManagement_8pm_source.html">CourseManagement.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 23:00:13 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
